
Global:
  # for mp2018 dataset, the property names are:
  # "formation_energy_per_atom",
  # "band_gap",
  # "G",
  # "K"
 property_names: ["formation_energy_per_atom"]


Trainer:
  epochs: 500
  output_dir: ./output/comformer_mp2018_train_60k_e_form
  save_freq: 100 # set 0 to disable saving during training
  log_freq: 100 # log frequency [step]
  start_eval_epoch: 1
  eval_freq: 1 # set 0 to disable evaluation during training
  seed: 42
  cal_metric_during_train: True # True: the metric will be calculated on train dataset
  use_amp: False

Module:
  __name__: RegressionModule
  model_cfg:
    __name__: iComformer
    property_names: ${Global.property_names}
  loss_cfg:
    __name__: LossWarper
    loss_fns:
      __name__: MSELoss
    apply_keys: ${Global.property_names}
  post_process_cfg:
    - UnNormalize:
        mean: -1.652
        std: 1.069
        apply_keys: "formation_energy_per_atom" # apply normalization to this property
  metric_cfg:
    __name__: MetricWarper
    metric_fns:
      __name__: MAEMetric
    apply_keys: ${Global.property_names}


Optimizer:
  __name__: AdamW
  lr:
    __name__: OneCycleLR
    max_learning_rate: 0.001
    by_epoch: True

Dataset:
  train:
    dataset:
      __name__: MP2018Dataset
      path: "./data/mp2018_train_60k/mp.2018.6.1_train.json"
      property_names: ${Global.property_names}
      build_structure_cfg:
        format: cif_str
        num_cpus: 10
      build_graph_cfg:
        cutoff: 4.0
        method: comformer_graph
        num_cpus: 10
      transforms:
        - Normalize:
            mean: -1.652
            std: 1.069
            apply_keys: "formation_energy_per_atom" # apply normalization to this property
    loader:
      num_workers: 4
      use_shared_memory: False
    sampler:
      __name__: DistributedBatchSampler
      shuffle: True
      drop_last: True
      batch_size: 32
  val:
    dataset:
      __name__: MP2018Dataset
      path: "./data/mp2018_train_60k/mp.2018.6.1_val.json"
      property_names: ${Global.property_names}
      build_structure_cfg:
        format: cif_str
        num_cpus: 10
      build_graph_cfg:
        cutoff: 4.0
        method: comformer_graph
        num_cpus: 10
      transforms:
        - Normalize:
            mean: -1.652
            std: 1.069
            apply_keys: "formation_energy_per_atom" # apply normalization to this property
    sampler:
      __name__: BatchSampler
      shuffle: False
      drop_last: False
      batch_size: 32
  test:
    dataset:
      __name__: MP2018Dataset
      path: "./data/mp2018_train_60k/mp.2018.6.1_test.json"
      property_names: ${Global.property_names}
      build_structure_cfg:
        format: cif_str
        num_cpus: 10
      build_graph_cfg:
        cutoff: 4.0
        method: comformer_graph
        num_cpus: 10
      transforms:
        - Normalize:
            mean: -1.652
            std: 1.069
            apply_keys: "formation_energy_per_atom" # apply normalization to this property
    sampler:
      __name__: BatchSampler
      shuffle: False
      drop_last: False
      batch_size: 64
